import streamlit as st
import time

# 1. í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • (ì´ê²Œ í”„ë¡ íŠ¸ì—”ë“œ ì œëª© ì„¤ì •ì…ë‹ˆë‹¤)
st.set_page_config(page_title="ë‚˜ë§Œì˜ AI ì±—ë´‡", page_icon="ğŸ¤–")

# 2. ì‚¬ì´ë“œë°” (ì˜µì…˜ ì„¤ì • ê³µê°„)
with st.sidebar:
    st.header("ğŸ› ï¸ ì„¤ì •")
    st.write("í†µì‹  ì „ê³µ AI ê°œë°œì í¬íŠ¸í´ë¦¬ì˜¤")
    st.info("ì´ê³³ì— ëª¨ë¸ íŒŒë¼ë¯¸í„°ë‚˜ ì„¤ì •ì„ ë„£ìœ¼ë©´ ì „ë¬¸ê°€ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.")

# 3. ë©”ì¸ í™”ë©´ ì œëª©
st.title("ğŸ’¬ AI ì§€ëŠ¥í˜• ì—ì´ì „íŠ¸ Demo")
st.caption("ğŸš€ LangChain & FastAPI ê¸°ë°˜ (í˜„ì¬ëŠ” ë°ëª¨ ëª¨ë“œì…ë‹ˆë‹¤)")

# 4. ì±„íŒ… ê¸°ë¡ì„ ì €ì¥í•  ê³µê°„ (ì„¸ì…˜ ìŠ¤í…Œì´íŠ¸)
# (ìƒˆë¡œê³ ì¹¨ í•´ë„ ëŒ€í™” ë‚´ìš©ì´ ì•ˆ ë‚ ì•„ê°€ê²Œ í•´ì¤ë‹ˆë‹¤)
if "messages" not in st.session_state:
    st.session_state["messages"] = [{"role": "assistant", "content": "ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? í†µì‹ /ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ì§ˆë¬¸ë„ ì¢‹ìŠµë‹ˆë‹¤."}]

# 5. ì´ì „ ëŒ€í™” ë‚´ìš©ì„ í™”ë©´ì— ë‹¤ì‹œ ê·¸ë ¤ì£¼ê¸°
for msg in st.session_state.messages:
    st.chat_message(msg["role"]).write(msg["content"])

# 6. ì‚¬ìš©ì ì…ë ¥ ë°›ê¸° (ì—¬ê¸°ê°€ í•µì‹¬ Input ì°½ì…ë‹ˆë‹¤)
if prompt := st.chat_input("ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."):
    # ì‚¬ìš©ì ë©”ì‹œì§€ í™”ë©´ì— í‘œì‹œ
    st.session_state.messages.append({"role": "user", "content": prompt})
    st.chat_message("user").write(prompt)

    # -------------------------------------------------------
    # [ì¤‘ìš”] ì—¬ê¸°ì— ë‚˜ì¤‘ì— ì§„ì§œ AI(ë­ì²´ì¸, LLM) ì½”ë“œë¥¼ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
    # ì§€ê¸ˆì€ 'ì²™'ë§Œ í•˜ëŠ” ê°€ì§œ ì‘ë‹µì„ ë„£ê² ìŠµë‹ˆë‹¤.
    # -------------------------------------------------------

    # AIê°€ ìƒê°í•˜ëŠ” ì²™ (ë¡œë”© íš¨ê³¼)
    with st.chat_message("assistant"):
        with st.spinner("AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
            time.sleep(2)  # 2ì´ˆ ë”œë ˆì´ë¡œ ì§„ì§œ ê³„ì‚°í•˜ëŠ” ëŠë‚Œ ì£¼ê¸°

            # ê°€ì§œ ì‘ë‹µ (ë‚˜ì¤‘ì— ì´ê±¸ ë­ì²´ì¸ ì—°ê²°ë¡œ ë°”ê¾¸ë©´ ë!)
            response = f"ì…ë ¥í•˜ì‹  ë‚´ìš©('{prompt}')ì— ëŒ€í•œ ë¶„ì„ ê²°ê³¼ì…ë‹ˆë‹¤.\n\ní˜„ì¬ëŠ” ë°ëª¨ ë²„ì „ì´ë¼ ë‹µë³€ì„ ìƒì„±í•  ìˆ˜ ì—†ì§€ë§Œ, ê³§ LangChain ëª¨ë¸ì´ ì—°ê²°ë  ì˜ˆì •ì…ë‹ˆë‹¤!"

            st.write(response)

    # ëŒ€í™” ê¸°ë¡ì— ì €ì¥
    st.session_state.messages.append({"role": "assistant", "content": response})